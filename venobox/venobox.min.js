/* 
 * VenoBox - jQuery Plugin
 * version: 1.3.3.1
 * @requires jQuery
 * @fork https://github.com/neuralquery/VenoBox
 * 
 * Examples at http://lab.veno.it/venobox/
 * License: Creative Commons Attribution 3.0 License
 * License URI: http://creativecommons.org/licenses/by/3.0/
 * Copyright 2013-2014 Nicola Franchini - @nicolafranchini
 *
 */
(function($){function loadAjax(){$.ajax({url:dest,cache:!1}).done(function(msg){content.html(applyAttributes('<div class="vbox-inline">'+msg+"</div>")),updateoverlay(!0)}).fail(function(){content.html('<div class="vbox-inline"><p>Error retrieving contents, please retry</div>'),updateoverlay(!0)})}function applyAttributes(html){var element=$(html);return $.each(attributes,function(name,value){element.attr(name,value)}),element}function loadIframe(){content.html(applyAttributes('<iframe class="venoframe" src="'+dest+'"></iframe>')),updateoverlay()}function loadVimeo(){var pezzi=dest.split("/"),videoid=pezzi[pezzi.length-1];content.html(applyAttributes('<iframe class="venoframe" src="http://player.vimeo.com/video/'+videoid+'"></iframe>')),updateoverlay()}function loadYoutube(){var pezzi=dest.split("/"),videoid=pezzi[pezzi.length-1];content.html(applyAttributes('<iframe class="venoframe" src="http://www.youtube.com/embed/'+videoid+'"></iframe>')),updateoverlay()}function loadInline(){content.html(applyAttributes('<div class="vbox-inline">'+$(dest).html()+"</div>")),updateoverlay()}function preloadFirst(){prima=$(".vbox-content").find("img"),prima.one("load",function(){updateoverlay()}).each(function(){this.complete&&$(this).load()})}function updateoverlay(notopzero){notopzero=notopzero||!1,1!=notopzero&&$(window).scrollTop(0),blocktitle.html(title),content.find(">:first-child").addClass("figlio"),$(".figlio").css("width",framewidth).css("height",frameheight).css("padding",border).css("background",bgcolor),sonH=content.outerHeight(),finH=$(window).height(),finH>sonH+80?(margine=(finH-sonH)/2,content.css("margin-top",margine),content.css("margin-bottom",margine)):(content.css("margin-top","40px"),content.css("margin-bottom","40px")),content.animate({opacity:"1"},"slow")}function updateoverlayresize(){$(".vbox-content").length&&(sonH=content.height(),finH=$(window).height(),finH>sonH+80?(margine=(finH-sonH)/2,content.css("margin-top",margine),content.css("margin-bottom",margine)):(content.css("margin-top","40px"),content.css("margin-bottom","40px")))}var ios,ie9,overlayColor,overlay,vwrap,container,content,core,dest,top,sonH,finH,margine,prima,framewidth,frameheight,attributes,border,bgcolor,thisgall,items,thenext,theprev,title,nextok,prevok,keyNavigationDisabled,blocktitle,blocknum,numeratio,evitanext,evitaprev,evitacontent,figliall,infinigall;$.fn.extend({venobox:function(options){var defaults={framewidth:"",frameheight:"",attributes:{},border:"0",bgcolor:"#fff",numeratio:!1,infinigall:!1},options=$.extend(defaults,options);return this.each(function(){var obj=$(this);obj.addClass("vbox-item"),obj.data("framewidth",options.framewidth),obj.data("frameheight",options.frameheight),obj.data("border",options.border),obj.data("bgcolor",options.bgcolor),obj.data("numeratio",options.numeratio),obj.data("infinigall",options.infinigall),attributes=options.attributes,ios=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,ie9=document.all&&!window.atob?!0:!1,obj.click(function(e){function checknav(){thisgall=obj.data("gall"),numeratio=obj.data("numeratio"),infinigall=obj.data("infinigall"),items=$('.vbox-item[data-gall="'+thisgall+'"]'),items.length>0&&numeratio===!0?(blocknum.html(items.index(obj)+1+" / "+items.length),blocknum.fadeIn()):blocknum.fadeOut(),thenext=items.eq(items.index(obj)+1),theprev=items.eq(items.index(obj)-1),obj.attr("title")?(title=obj.attr("title"),blocktitle.fadeIn()):(title="",blocktitle.fadeOut()),infinigall===!0?(nextok=!0,prevok=!0,1>thenext.length&&(thenext=items.eq(0)),1>items.index(obj)&&(theprev=items.eq(items.index(items.length)))):(thenext.length>0?($(".vbox-next").css("display","block"),nextok=!0):($(".vbox-next").css("display","none"),nextok=!1),items.index(obj)>0?($(".vbox-prev").css("display","block"),prevok=!0):($(".vbox-prev").css("display","none"),prevok=!1))}return e.stopPropagation(),e.preventDefault(),obj=$(this),overlayColor=obj.data("overlay"),framewidth=obj.data("framewidth"),frameheight=obj.data("frameheight"),border=obj.data("border"),bgcolor=obj.data("bgcolor"),nextok=!1,prevok=!1,keyNavigationDisabled=!1,dest=obj.attr("href"),top=$(window).scrollTop(),top=-top,$("body").wrapInner('<div class="vwrap"></div>'),vwrap=$(".vwrap"),core='<div class="vbox-overlay" style="background:'+overlayColor+'"><div class="vbox-preloader">Loading...</div><div class="vbox-container"><div class="vbox-content"></div></div><div class="vbox-title"></div><div class="vbox-num">0/0</div><div class="vbox-close">X</div><div class="vbox-next">next</div><div class="vbox-prev">prev</div></div>',$("body").append(core),overlay=$(".vbox-overlay"),container=$(".vbox-container"),content=$(".vbox-content"),blocknum=$(".vbox-num"),blocktitle=$(".vbox-title"),content.html(""),content.css("opacity","0"),checknav(),overlay.css("min-height",$(window).outerHeight()+130),ie9?overlay.animate({opacity:1},250,function(){overlay.css({"min-height":$(window).outerHeight(),height:"auto"}),"iframe"==obj.data("type")?loadIframe():"inline"==obj.data("type")?loadInline():"ajax"==obj.data("type")?loadAjax():"vimeo"==obj.data("type")?loadVimeo():"youtube"==obj.data("type")?loadYoutube():(content.html('<img src="'+dest+'">'),preloadFirst())}):(overlay.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){overlay.css({"min-height":$(window).outerHeight(),height:"auto"}),"iframe"==obj.data("type")?loadIframe():"inline"==obj.data("type")?loadInline():"ajax"==obj.data("type")?loadAjax():"vimeo"==obj.data("type")?loadVimeo():"youtube"==obj.data("type")?loadYoutube():(content.html('<img src="'+dest+'">'),preloadFirst())}),overlay.css("opacity","1")),ios?vwrap.css({position:"fixed",top:top,opacity:"0"}).data("top",top):(vwrap.css({position:"fixed",top:top}).data("top",top),$(window).scrollTop(0)),$("body").keydown(function(e){keyNavigationDisabled||(37==e.keyCode&&1==prevok&&(keyNavigationDisabled=!0,overlayColor=theprev.data("overlay"),framewidth=theprev.data("framewidth"),frameheight=theprev.data("frameheight"),border=theprev.data("border"),bgcolor=theprev.data("bgcolor"),dest=theprev.attr("href"),title=theprev.attr("title")?theprev.attr("title"):"",void 0===overlayColor&&(overlayColor=""),overlay.css("min-height",$(window).outerHeight()+130),content.animate({opacity:0},500,function(){overlay.css("min-height",$(window).outerHeight()).css("background",overlayColor),"iframe"==theprev.data("type")?loadIframe():"inline"==theprev.data("type")?loadInline():"ajax"==theprev.data("type")?loadAjax():"youtube"==theprev.data("type")?loadYoutube():"vimeo"==theprev.data("type")?loadVimeo():(content.html('<img src="'+dest+'">'),preloadFirst()),obj=theprev,checknav(),keyNavigationDisabled=!1})),39==e.keyCode&&1==nextok&&(keyNavigationDisabled=!0,overlayColor=thenext.data("overlay"),framewidth=thenext.data("framewidth"),frameheight=thenext.data("frameheight"),border=thenext.data("border"),bgcolor=thenext.data("bgcolor"),dest=thenext.attr("href"),title=thenext.attr("title")?thenext.attr("title"):"",void 0===overlayColor&&(overlayColor=""),overlay.css("min-height",$(window).outerHeight()+130),content.animate({opacity:0},500,function(){overlay.css("min-height",$(window).outerHeight()).css("background",overlayColor),"iframe"==thenext.data("type")?loadIframe():"inline"==thenext.data("type")?loadInline():"ajax"==thenext.data("type")?loadAjax():"youtube"==thenext.data("type")?loadYoutube():"vimeo"==thenext.data("type")?loadVimeo():(content.html('<img src="'+dest+'">'),preloadFirst()),obj=thenext,checknav(),keyNavigationDisabled=!1})))}),$(".vbox-next").click(function(){overlayColor=thenext.data("overlay"),framewidth=thenext.data("framewidth"),frameheight=thenext.data("frameheight"),border=thenext.data("border"),bgcolor=thenext.data("bgcolor"),dest=thenext.attr("href"),title=thenext.attr("title")?thenext.attr("title"):"",void 0===overlayColor&&(overlayColor=""),overlay.css("min-height",$(window).outerHeight()+130),content.animate({opacity:0},500,function(){overlay.css("min-height",$(window).outerHeight()).css("background",overlayColor),"iframe"==thenext.data("type")?loadIframe():"inline"==thenext.data("type")?loadInline():"ajax"==thenext.data("type")?loadAjax():"youtube"==thenext.data("type")?loadYoutube():"vimeo"==thenext.data("type")?loadVimeo():(content.html('<img src="'+dest+'">'),preloadFirst()),obj=thenext,checknav()})}),$(".vbox-prev").click(function(){overlayColor=theprev.data("overlay"),framewidth=theprev.data("framewidth"),frameheight=theprev.data("frameheight"),border=theprev.data("border"),bgcolor=theprev.data("bgcolor"),dest=theprev.attr("href"),title=theprev.attr("title")?theprev.attr("title"):"",void 0===overlayColor&&(overlayColor=""),overlay.css("min-height",$(window).outerHeight()+130),content.animate({opacity:0},500,function(){overlay.css("min-height",$(window).outerHeight()).css("background",overlayColor),"iframe"==theprev.data("type")?loadIframe():"inline"==theprev.data("type")?loadInline():"ajax"==theprev.data("type")?loadAjax():"youtube"==theprev.data("type")?loadYoutube():"vimeo"==theprev.data("type")?loadVimeo():(content.html('<img src="'+dest+'">'),preloadFirst()),obj=theprev,checknav()})}),$(".vbox-close, .vbox-overlay").click(function(e){evitacontent=".figlio",evitaprev=".vbox-prev",evitanext=".vbox-next",figliall=".figlio *",$(e.target).is(evitacontent)||$(e.target).is(evitanext)||$(e.target).is(evitaprev)||$(e.target).is(figliall)||(ie9?overlay.animate({opacity:0},500,function(){overlay.remove(),$(".vwrap").children().unwrap(),$(window).scrollTop(-top),keyNavigationDisabled=!1}):(overlay.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),overlay.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){overlay.remove(),ios?($(".vwrap").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(".vwrap").children().unwrap(),$(window).scrollTop(-top)}),$(".vwrap").css("opacity","1")):($(".vwrap").children().unwrap(),$(window).scrollTop(-top)),keyNavigationDisabled=!1}),overlay.css("opacity","0")))}),!1})})}}),$(window).resize(function(){updateoverlayresize()})})(jQuery);